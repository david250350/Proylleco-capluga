<!DOCTYPE html>
<html>
<head>
    <title>CAPLUGA</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Proyecto de demostración CareMed">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="~/Template/styles/bootstrap4/bootstrap.min.css">
    <link rel="stylesheet" href="~/Template/plugins/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="~/Template/styles/main_styles.css">


    <!-- Incluir CSS de DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.6.0/nouislider.min.css" rel="stylesheet">
 

</head>
<body>
    <div class="super_container">
        <!-- Encabezado -->
        <section>
            <header class="header trans_200">
                <!-- Barra superior -->
                <div class="top_bar">
                    <div class="container">
                        <div class="row">
                            <div class="top_bar_content d-flex flex-row align-items-center justify-content-start col-8">
                                @if (Session["Rol"].ToString() == "1" && Session != null)
                                {
                                    <div class="top_bar_item"><a href="@Url.Action("Admin","Home")">Administrador</a></div>
                                    <div class="top_bar_item"><a href="@Url.Action("Index", "Usuario")">Usuarios</a></div>

                                    <div class="nav-item dropdown">
                                        <a class="nav-link text-white" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Citas
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                            <a class="dropdown-item" href="@Url.Action("ConsultaHorarios", "CitaHorario")"> Lista de horarios</a>
                                            <a class="dropdown-item" href="@Url.Action("RegistrarHorarios", "CitaHorario")">Nuevo cita</a>
                                            <a class="dropdown-item" href="@Url.Action("ConsultaCitas", "AgendaCita")">Lista de citas </a>
                                        </div>
                                    </div>

                                    <div class="nav-item dropdown">
                                        <a class="nav-link text-white" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Cursos
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                            <a class="dropdown-item" href="@Url.Action("ConsultaCursos", "MedicalCourses")">Lista de Cursos</a>
                                            <a class="dropdown-item" href="@Url.Action("RegistrarCursos", "MedicalCourses")">Nuevo Curso</a>
                                            <a class="dropdown-item" href="@Url.Action("EstadoCurso", "Registeredcourses")">Listas de Inscripciones</a>
                                        </div>
                                    </div>

                                    <div class="nav-item dropdown">
                                        <a class="nav-link text-white" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Roles
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                            <a class="dropdown-item" href="@Url.Action("CrearRol", "Rol")">Nuevo Rol</a>
                                            <a class="dropdown-item" href="@Url.Action("ListaRoles", "Rol")">Lista Rol</a>
                                        </div>
                                    </div>

                                    <div class="nav-item dropdown">
                                        <a class="nav-link text-white" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Productos
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                            <a class="dropdown-item" href="@Url.Action("Productos", "Producto")">Lista de productos</a>
                                            <a class="dropdown-item" href="@Url.Action("RegistrarProducto", "Producto")">Nuevo Producto</a>
                                            <a class="dropdown-item" href="@Url.Action("ConsultaCarritoadm", "Carrito")">Lista de Pedidos</a>
                                        </div>
                                    </div>


                                }
                                else
                                {

                                }

                            </div>

                            <div class="col col-2"></div>
                        </div>
                    </div>
                </div>
                <!-- Logo -->
                <div class="logo_container_outer">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="logo_container">
                                    <a href="@Url.Action("Index","Home")">
                                        <div class="logo_content d-flex flex-column align-items-start justify-content-center">
                                            <div class="logo_line"></div>
                                            <div class="logo d-flex flex-row align-items-center justify-content-center">
                                                <div class="logo_text">CAPLUGA</div>
                                            </div>
                                            <div class="logo_sub">¡Salvá una vida con tus manos!</div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Contenido del encabezado -->
                <div class="header_container">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <div class="header_content d-flex flex-row align-items-center justify-content-start">
                                    <nav class="main_nav ml-auto">
                                        <ul>
                                            <li><a href="@Url.Action("About", "Home")">Acerca de nosotros</a></li>
                                            <li><a href="@Url.Action("VistaCurso", "MedicalCourses")">Cursos</a></li>
                                            <li><a href="@Url.Action("VistaProducto", "Producto")">Producto</a></li>
                                            <li><a href="@Url.Action("RegistrarCita", "AgendaCita")">Agendar Cita</a></li>
                                            <li><a href="@Url.Action("ConsultaCarrito", "Carrito")">Carrito</a></li>
                                            @if (@Session["Nombre"] == null)
                                            {
                                                <li><a href="@Url.Action("IniciarSesion","Login")">Iniciar Sesión</a></li>
                                            }
                                            else
                                            {
                                                
                                                <li class="nav-item dropdown">
                                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                        <i class="fa fa-user-circle"></i> @Session["Nombre"].ToString()
                                                    </a>
                                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                                                        <a class="dropdown-item" href="@Url.Action("ConsultarInscripcion", "Registeredcourses")">Inscripciones</a>
                                                        <a class="dropdown-item" href="@Url.Action("ConsultaCita", "AgendaCita")">Citas</a>
                                                        <a class="dropdown-item" href="@Url.Action("ConsultaFacturas", "Carrito")">Mis Pedidos</a>
                                                        <a class="dropdown-item" href="@Url.Action("ConsultaFacturasCurso", "Registeredcourses")">Mis Cursos</a>
                                                        <a class="dropdown-item" href="@Url.Action("PerfilUsuario", "Usuario")">Editar perfil</a>
                                                        <a class="dropdown-item" href="@Url.Action("CerrarSesion", "Login")">Cerrar sesion</a>
                                                    </div>
                                                </li>
                                            }
                                        </ul>
                                    </nav>
                                    <div class="hamburger ml-auto"><i class="fa fa-bars" aria-hidden="true"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        </section>
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <!-- Cuerpo de la página -->
        <section>
            @RenderBody()
        </section>
        <br />
        <br />
        <br />
        <br />
        <br />

        <!-- Vista parcial del pie de la página -->
        @Html.Partial("~/Views/Shared/_Layout_Footer.cshtml")
    </div>


    <script src="/Funcion/Ubicaciones.js"></script>




    <script>
        function confirmStateChange(url) {
            Swal.fire({
                title: '¿Está seguro?',
                text: "Seguro de cambiar el estado.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Aceptar!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url;
                }
            });
        }

        function confirmUpdate() {
            Swal.fire({
                title: '¿Está seguro?',
                text: "Seguro de actualizar.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Aceptar!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    $("form").submit(); // asume que solo hay un formulario en tu página
                }
            });
        }

        function confirmInsert() {
            Swal.fire({
                title: '¿Está seguro?',
                text: "Seguro de agregar.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Aceptar!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    $("form").submit(); // asume que solo hay un formulario en tu página
                }
            });
        }

        function confirmPayment() {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Continuar con el Proceso.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Confirmar ',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('paymentForm').submit(); // Envía el formulario de pago
                }
            });
        }


        function confirmDelete(url) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Seguro de Eliminar",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Eliminar!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url; // Redirige para eliminar la cita si el usuario confirma
                }
            });
        }
    </script>


    <script>
        flatpickr("#horaPicker", {
            enableTime: true,
            dateFormat: "Y-m-d H:i",
            locale: "es",
            altInput: true,
            altFormat: "F j, Y, H:i",
            time_24hr: true
        });
    </script>

     @*Inicializar DataTables*@ 
    <script>
            $(document).ready(function () {
                console.log("Document ready, initializing DataTable...");
                console.log("jQuery version:", $.fn.jquery);
                console.log("DataTable function exists:", typeof $.fn.DataTable === 'function');

                if (typeof $.fn.DataTable === 'function') {
                    $('#DataTable').DataTable({
                        "language": {
                            "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                        }
                    });
                } else {
                    console.error("DataTable function is not available. Check if DataTables script is loaded correctly.");
                }
            });
        </script>

    @*<script>
        $(document).ready(function () {
            $('#DataTable').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Spanish.json"
                },
                "paging": true,
                "info": false
            });
        });</script>
    <script src="~/Scripts/confirm.js"></script>*@

    <script>

    function RegistrarInscripcion(medicalCourseID, disponible) {
        let quantity = $("#prd-" + medicalCourseID).val();

        if (quantity > disponible) {
          alert("Su solicitud supera la cantidad de unidades disponibles");
      }else {

            $.ajax({
                url: '/Registeredcourses/RegistrarInscripcion',
            type: "GET",
            data:
            {
                "quantity": quantity,
                "medicalCourseID": medicalCourseID
            },
            success: function (data) {
               window.location.href = '@Url.Action("VistaCurso", "MedicalCourses")';
            }
        });

      }
        }

   function AgrearCarrito(medicalImplementsID, disponible) {
     let quantity = $("#prd-" + medicalImplementsID).val();

     if (quantity > disponible) {
         alert("Su solicitud supera la cantidad de unidades disponibles");
     } else {
         $.ajax({
             url: '/Carrito/RegistrarCarrito',
             type: "GET",
             data: {
                 "quantity": quantity,
                 "medicalImplementsID": medicalImplementsID
             },
             success: function (data) {
                 window.location.href = '@Url.Action("VistaProducto", "Producto")';
             }
         });
     }
 }

    </script>


    <script>
        document.getElementById('buscar').addEventListener('keyup', function () {
            aplicarFiltros();
        });

        function aplicarFiltros() {
            var searchText = document.getElementById('buscar').value.toLowerCase();
            var precioMin = parseFloat(document.getElementById('precioMin').value) || 0;
            var precioMax = parseFloat(document.getElementById('precioMax').value) || Infinity;
            var ordenFiltro = document.getElementById('ordenFiltro').value;

            filtrar(searchText, precioMin, precioMax);
            ordenar(ordenFiltro);
        }

        function filtrar(searchText, precioMin, precioMax) {
            var productCards = document.querySelectorAll('.filtro-card');

            productCards.forEach(function (card) {
                var productName = card.querySelector('.card-title').textContent.toLowerCase();
                var productDescription = card.querySelector('.card-text').textContent.toLowerCase();
                var productPrice = parseFloat(card.dataset.precio);

                if ((productName.includes(searchText) || productDescription.includes(searchText)) &&
                    (productPrice >= precioMin && productPrice <= precioMax)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function ordenar(ordenFiltro) {
            var container = document.getElementById('FiltroContainer');
            var productCards = Array.from(container.getElementsByClassName('filtro-card'));

            if (ordenFiltro === 'precioAsc') {
                productCards.sort(function (a, b) {
                    var precioA = parseFloat(a.dataset.precio);
                    var precioB = parseFloat(b.dataset.precio);
                    return precioA - precioB;
                });
            } else if (ordenFiltro === 'precioDesc') {
                productCards.sort(function (a, b) {
                    var precioA = parseFloat(a.dataset.precio);
                    var precioB = parseFloat(b.dataset.precio);
                    return precioB - precioA;
                });
            } else if (ordenFiltro === 'nombreAsc') {
                productCards.sort(function (a, b) {
                    var nombreA = a.dataset.nombre.toLowerCase();
                    var nombreB = b.dataset.nombre.toLowerCase();
                    return nombreA.localeCompare(nombreB);
                });
            } else if (ordenFiltro === 'nombreDesc') {
                productCards.sort(function (a, b) {
                    var nombreA = a.dataset.nombre.toLowerCase();
                    var nombreB = b.dataset.nombre.toLowerCase();
                    return nombreB.localeCompare(nombreA);
                });
            }

            container.innerHTML = '';
            productCards.forEach(function (card) {
                container.appendChild(card);
            });
        }


    </script>

</body>
</html>